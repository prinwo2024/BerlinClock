<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berlin-Clock-wise</title>
    <style>
		#secondsContainer {
            border: none;
            text-align: center; 
			width: 100%;
			background-color: white;
			margin-left: auto;
			margin-right: auto;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		
		#yellowCircle {
			width: 60px;
			height: 60px;
			background-color: yellow;
			border: 3px solid black;
			border-radius: 50%;
		}
		
		#greyCircle {
			width: 60px;
			height: 60px;
			background-color: lightgrey;
			border: 3px solid black;
			border-radius: 50%;
		}
		
		.outerTable {
			border: 2px solid black;
			border-collapse: collapse;
			width: 400px;
		}
		
		.outerCell {
			width: 100%;
		}

		.innerTable {
			background-color: white;
			border-collapse: collapse;
			border: none;
			width: 100%;
		}
		.innerTimeCellNormal {
			border-right: 2px solid black;
			border-top: none;
			border-left: none;
			border-bottom: 2px solid black;
			height: 60px; 
			backgroundColor: white; 
			text-align: center; 
			vertical-align: middle;
			width: 12%;
		}	
	
		.innerTimeCellRight {
			border-right: none;
			border-top: none;
			border-left: none;
			border-bottom: 2px solid black;
			height: 60px; 
			width: 12%;
			backgroundColor: white; 
			text-align: center; 
			vertical-align: middle;
		}	
	
		.innerMinutesCellNormal {
			border-right: 2px solid black;
			border-top: 2px solid black;
			border-left: none;
			border-bottom: 2px solid black;
			height: 60px; 
			width: 9%; 
			text-align: center; 
			vertical-align: middle;
		}	
	
		.innerMinutesCellRight {
			border-right: none;
			border-top: 2px solid black;
			border-left: none;
			border-bottom: 2px solid black;
			height: 60px; 
			width: 9%; 
			text-align: center; 
			vertical-align: middle;
		}	

		.innerLampsCellNormal {
			border-right: 2px solid black;
			border-top: 2px solid black;
			border-left: none;
			border-bottom: 2px solid black;
			height: 60px; 
			width: 25%;
			text-align: center; 
			vertical-align: middle;
		}	
	
		.innerLampsCellRight {
			border-right: none;
			border-top: 2px solid black;
			border-left: none;
			border-bottom: 2px solid black;
			height: 60px; 
			width: 25%;
			text-align: center; 
			vertical-align: middle;
		}	

  </style>
</head>
<body>
	<br>
	<br>
    <h2>Select a data file</h2>
	<br>
    <input type="file" id="fileInput" accept=".dat">
	<br>
	<br>
	<br>
    <table id="dataTable">
        <tbody id="dataTableBody">
            <!-- Table newTableRows and cells will be added here by JavaScript -->
        </tbody>
    </table>
	<br>
	<br>

    <script>
        const fileInput = document.getElementById('fileInput');
        const dataTableBody = document.getElementById('dataTableBody');
		document.getElementById('dataTable').classList.add('outerTable');


        // On every user selection this will be executed 
        // Continous refresh is impossible within this context 
        fileInput.addEventListener('change', function(event) {
            const userfile = event.target.files[0];
            if (userfile) {
                const reader = new FileReader();

                reader.onload = function(e) {
                    const text = e.target.result;
                    populateTableWithCharacters(text); 
                };

                reader.onerror = function(e) {
                    dataTableBody.innerHTML = `<tr><td>Error reading file: ${e.target.error.name}</td></tr>`;
                };
				// Let the user choose the next iteration 
                reader.readAsText(userfile);
            }
			event.target.value = '';
        });
		
		function CalcLampColor(character) {
			// Conditional coloring based on character
			if (character === '0') {
				return 'white';  // lamp iS off 
			} else if (character === '1') {
				return 'yellow';  // Minutes: yellow lamp 
			} else if (character === '2') {
				return 'red';  // red lamp. Hours or Minutegroups: every three groups 
			} else {
				return 'lightgrey';  // error fallback 
			}
		}

        // Construct the table and its content 
        function populateTableWithCharacters(text) {
            dataTableBody.innerHTML = ''; 
            const lines = text.split(/\r\n|\n|\r/); 
			var lineCounter = 0;
            lines.forEach((line) => {
                if (line.trim() === '') return; 
				// Create new table row 
                const newTableRow = document.createElement('tr'); 
				// Human readable time
				if (lineCounter == 0) {  
						const cell = document.createElement('td');
						cell.classList.add('outerCell');
						const innerTable = document.createElement('table'); 
						innerTable.classList.add('innerTable');
						const newInnerRow = document.createElement('tr'); 
						for (let i = 0; i < line.length; i++) {
							const character = line[i];
							const innerCell = document.createElement('td');
							if (i < (line.length-1)) {
								innerCell.classList.add('innerTimeCellNormal'); 
							} else {
								// innerCell.style.borderRight = 'none';
								innerCell.classList.add('innerTimeCellRight');
							}
							innerCell.textContent = character;
							newInnerRow.appendChild(innerCell); 
						} 
						innerTable.appendChild(newInnerRow);
						cell.appendChild(innerTable);
						newTableRow.appendChild(cell); 
				// Round lamp signal for the seconds 
				} else if (lineCounter == 1) {  
						const character = line[0];
						const cell = document.createElement('td');
						cell.classList.add('outerCell');
						cell.style.textAlign = 'center';

						const secondsDiv = document.createElement("div");  // needed for center alignment
						secondsDiv.id = 'secondsContainer';
						const kreisDiv = document.createElement("div");
						if (character === '0') {
							kreisDiv.id = 'greyCircle';
						} else {
							kreisDiv.id = 'yellowCircle';
						}
						secondsDiv.appendChild(kreisDiv);
						cell.appendChild(secondsDiv);
						newTableRow.appendChild(cell); 
				// Minutes in 11 groups of 5 
				} else if (lineCounter == 4) {
						const cell = document.createElement('td');
						cell.classList.add('outerCell');
						const innerTable = document.createElement('table'); 
						innerTable.classList.add('innerTable');
						cell.appendChild(innerTable);
						const newInnerRow = document.createElement('tr'); 
						for (let i = 0; i < line.length; i++) {
							const character = line[i];
							const innerCell = document.createElement('td');
							if (i < (line.length-1)) {
								innerCell.classList.add('innerMinutesCellNormal'); 
							} else {
								// innerCell.style.borderRight = 'none';
								innerCell.classList.add('innerMinutesCellRight');
							}

							innerCell.style.backgroundColor = CalcLampColor(character);
							newInnerRow.appendChild(innerCell); 
						} 
						innerTable.appendChild(newInnerRow);
						newTableRow.appendChild(cell); 
				// Hours and single minutes
				} else {
						const cell = document.createElement('td');
						cell.classList.add('outerCell');
						const innerTable = document.createElement('table'); 
						innerTable.classList.add('innerTable');
						cell.appendChild(innerTable);
						const newInnerRow = document.createElement('tr'); 
						for (let i = 0; i < line.length; i++) {
							const character = line[i];
							const innerCell = document.createElement('td');
							if (i < (line.length-1)) {
								innerCell.classList.add('innerLampsCellNormal'); 
							} else {
								// innerCell.style.borderRight = 'none';
								innerCell.classList.add('innerLampsCellRight');
							}

							innerCell.style.backgroundColor = CalcLampColor(character);
							newInnerRow.appendChild(innerCell); 
						}
						innerTable.appendChild(newInnerRow);
						newTableRow.appendChild(cell); 
                }
                dataTableBody.appendChild(newTableRow);
				lineCounter++;
            });
        }

    </script>
</body>
</html>
